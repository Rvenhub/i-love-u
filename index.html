<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå‡∏ô‡∏∞‡πÄ‡∏°‡∏¢‡πå! üíñ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- 1. THEME & VARIABLES --- */
        :root {
            --primary: #ff9a9e;
            --primary-dark: #ff6b81;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: 2px solid rgba(255, 255, 255, 0.8);
            --font-head: 'Mali', cursive;
            --font-body: 'Prompt', sans-serif;
        }

        body {
            margin: 0; padding: 0;
            font-family: var(--font-body);
            color: #555;
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 140px;
            background: #333;
        }

        /* --- 2. BACKGROUNDS --- */
        .bg-scene { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; transition: opacity 1.5s ease; opacity: 0; pointer-events: none; overflow: hidden; }
        
        /* Morning */
        body.morning-mode .bg-morning { opacity: 1; }
        .bg-morning { background: linear-gradient(180deg, #a1c4fd 0%, #c2e9fb 100%); }
        .sun-container { position: absolute; top: 10%; left: 50%; transform: translateX(-50%); width: 150px; height: 150px; animation: floatSun 6s ease-in-out infinite; }
        .sun { width: 100%; height: 100%; background: #ffd700; border-radius: 50%; box-shadow: 0 0 40px #ffd700, 0 0 80px rgba(255, 215, 0, 0.6); }
        @keyframes floatSun { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .cloud { position: absolute; background: #fff; border-radius: 50px; opacity: 0.8; animation: moveCloud linear infinite; filter: blur(5px); }
        @keyframes moveCloud { from { left: -20%; } to { left: 120%; } }
        
        .bird-final { position: absolute; font-size: 24px; z-index: -1; will-change: transform; top: var(--startY); }
        @keyframes flyRightWavy { 0% { transform: translateX(-10vw) translateY(0) scaleX(1); } 50% { transform: translateX(60vw) translateY(0) scaleX(1); } 100% { transform: translateX(120vw) translateY(0) scaleX(1); } }
        @keyframes flyLeftWavy { 0% { transform: translateX(110vw) translateY(0) scaleX(-1); } 50% { transform: translateX(50vw) translateY(0) scaleX(-1); } 100% { transform: translateX(-10vw) translateY(0) scaleX(-1); } }

        /* Night */
        body.night-mode .bg-night { opacity: 1; }
        body.night-mode { color: #f0f0f0; }
        body.night-mode h1, body.night-mode h2, body.night-mode h3 { color: #ffcae5; }
        .bg-night { background: linear-gradient(to bottom, #0f0c29, #1a1a40, #270f36); }
        .shooting-star-final { position: absolute; width: 100px; height: 2px; background: linear-gradient(90deg, currentColor, transparent); border-radius: 50%; opacity: 0; filter: drop-shadow(0 0 5px currentColor); transform-origin: left center; }
        @keyframes shootAcrossScreen { 0% { opacity: 1; transform: translate(var(--startX), var(--startY)) rotate(var(--angle)) scale(0.5); } 100% { opacity: 0; transform: translate(calc(var(--startX) + 150vw), calc(var(--startY) + 150vh)) rotate(var(--angle)) scale(1.2); } }

        canvas#particle-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }

        /* --- 3. UI COMPONENTS --- */
        .container { max-width: 550px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }
        .page { display: none; } .page.active { display: block; animation: softFadeIn 0.8s ease; } @keyframes softFadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        .card, .timeline-item { background: var(--glass-bg); backdrop-filter: blur(25px); border-radius: 35px; border: var(--glass-border); padding: 30px; margin-bottom: 25px; box-shadow: 0 15px 40px rgba(0,0,0,0.05); transition: transform 0.3s ease; }
        body.night-mode .card, body.night-mode .timeline-item { background: rgba(40, 40, 60, 0.65); border: 1px solid rgba(255,255,255,0.1); }
        
        h1, h2, h3 { font-family: var(--font-head); color: var(--primary-dark); text-align: center; margin-bottom: 15px; } h1 { font-size: 2.5rem; text-shadow: 2px 2px 0 rgba(255,255,255,0.8); } p { line-height: 1.8; font-size: 1.05rem; }
        
        .btn { font-family: var(--font-head); background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); color: #fff; border: none; padding: 15px 30px; border-radius: 50px; font-size: 1.2rem; font-weight: 700; cursor: pointer; width: 100%; margin-top: 15px; box-shadow: 0 8px 25px rgba(255, 154, 158, 0.5); transition: all 0.3s; position: relative; overflow: hidden; } .btn:hover { transform: scale(1.05); } .btn:active { transform: scale(0.95); }
        .btn-outline { background: white; color: var(--primary-dark); border: 2px solid #ff9a9e; }
        .btn-locked { background: #e0e0e0 !important; color: #aaa !important; box-shadow: none !important; cursor: not-allowed; opacity: 0.7; } .btn-locked::after { content: ' üîí'; }
        
        /* Utils */
        .hidden { display: none !important; }
        
        /* Theme Selector */
        .theme-selector { display: flex; gap: 15px; margin-top: 30px; width: 100%; } .theme-btn { flex: 1; padding: 20px 10px; border-radius: 30px; border: none; cursor: pointer; transition: 0.3s; font-family: var(--font-head); font-weight: bold; font-size: 1rem; position: relative; overflow: hidden; } .btn-morning { background: linear-gradient(135deg, #ffd194, #70e1f5); color: #fff; } .btn-night { background: linear-gradient(135deg, #30cfd0, #330867); color: #fff; } .theme-btn:hover { transform: translateY(-5px) scale(1.05); }

        /* Timeline & Gallery */
        .timeline { padding-left: 20px; border-left: 4px dotted rgba(255,255,255,0.8); margin-left: 10px; } .timeline-item::before { content: '‚ù§Ô∏è'; position: absolute; left: -44px; top: 25px; background: white; border-radius: 50%; padding: 8px; font-size: 1.1rem; box-shadow: 0 5px 15px rgba(0,0,0,0.1); } .timeline-img { width: 100%; max-height: 350px; object-fit: cover; border-radius: 25px; margin-top: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .gallery-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; } .gallery-item { position: relative; aspect-ratio: 1/1; border-radius: 20px; background: white; padding: 6px; cursor: pointer; transition: 0.4s; box-shadow: 0 5px 15px rgba(0,0,0,0.05); } .gallery-item:hover { transform: rotate(-3deg) scale(1.03); z-index: 5; } .gallery-item img { width: 100%; height: 100%; object-fit: cover; border-radius: 16px; } .delete-btn { position: absolute; top: -5px; right: -5px; background: #ff477e; color: white; width: 30px; height: 30px; border-radius: 50%; border: none; cursor: pointer; box-shadow: 0 3px 10px rgba(0,0,0,0.2); }

        /* Game Menu */
        .game-menu-item { display: flex; align-items: center; justify-content: space-between; padding: 25px; background: white; border-radius: 30px; margin-bottom: 20px; cursor: pointer; border: 3px solid transparent; transition: 0.3s; box-shadow: 0 5px 20px rgba(0,0,0,0.05); } .game-menu-item:hover { border-color: var(--primary); transform: translateX(5px); } .game-menu-item.completed { background: #e8f5e9; border-color: #2ecc71; } .game-icon { font-size: 3rem; margin-right: 20px; background: #fff5f8; padding: 15px; border-radius: 50%; }

        /* Player */
        .music-player { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 85%; max-width: 380px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(30px); border-radius: 60px; padding: 12px 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 15px; z-index: 1000; border: 3px solid rgba(255,255,255,0.8); } .player-disc { width: 50px; height: 50px; border-radius: 50%; background: #222; border: 2px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.2); background-image: url('https://placehold.co/100x100/333/fff?text=üéµ'); background-size: cover; animation: spin 5s linear infinite; animation-play-state: paused; } .player-disc.playing { animation-play-state: running; } @keyframes spin { 100% { transform: rotate(360deg); } } .player-info { flex: 1; overflow: hidden; display: flex; flex-direction: column; justify-content: center; } .track-name { font-weight: 700; font-size: 0.95rem; color: #333; white-space: nowrap; } .play-btn { width: 45px; height: 45px; border-radius: 50%; background: var(--primary-dark); color: white; border: none; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; box-shadow: 0 5px 15px rgba(255,71,126,0.4); transition: transform 0.2s; } .play-btn:active { transform: scale(0.9); } .visualizer { display: flex; align-items: flex-end; gap: 3px; height: 20px; margin-right: 10px; } .bar { width: 4px; background: var(--primary); border-radius: 4px; animation: bounce 0.6s ease-in-out infinite alternate; } .visualizer.stopped .bar { animation: none; height: 4px; } @keyframes bounce { 0% { height: 5px; } 100% { height: 100%; } }

        /* QUIZ STYLES (ENHANCED) */
        .quiz-progress { display: flex; gap: 8px; margin-bottom: 25px; justify-content: center; } .progress-dot { width: 12px; height: 12px; background: #eee; border-radius: 50%; transition: 0.3s; } .progress-dot.active { background: var(--primary); transform: scale(1.4); } .progress-dot.done { background: #2ecc71; }
        .quiz-option { background: white; border: 2px solid #f0f0f0; padding: 18px 25px; margin-bottom: 15px; border-radius: 20px; cursor: pointer; transition: 0.3s; font-weight: 600; color: #555; display: flex; align-items: center; font-size: 1.05rem; } 
        .quiz-option:hover { border-color: var(--primary); color: var(--primary); transform: translateX(5px); }
        
        /* Quiz Animations */
        .quiz-option.correct { background: #e3f9e5; border-color: #2ecc71; color: #218c74; animation: bounceSuccess 0.5s ease; }
        .quiz-option.wrong { background: #ffeaea; border-color: #ff6b81; color: #c0392b; animation: shakeError 0.4s ease; }
        @keyframes bounceSuccess { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes shakeError { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* Overlays */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); z-index: 2000; display: none; align-items: center; justify-content: center; } .overlay-box { background: white; width: 85%; max-width: 350px; padding: 40px 30px; border-radius: 40px; text-align: center; box-shadow: 0 25px 70px rgba(0,0,0,0.3); animation: zoomIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); } @keyframes zoomIn { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } } .inst-icon { font-size: 4rem; margin-bottom: 15px; display: block; animation: float 3s infinite ease-in-out; } @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } } .result-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.95); display: none; flex-direction: column; align-items: center; justify-content: center; border-radius: 28px; z-index: 50; padding: 20px; text-align: center; } .result-overlay.show { display: flex; animation: fadeIn 0.5s; }

        /* Games */
        .memory-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin: 20px 0; } .memory-card { aspect-ratio: 1/1; cursor: pointer; perspective: 1000px; } .memory-inner { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: 0.6s; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); } .memory-card.flipped .memory-inner { transform: rotateY(180deg); } .mem-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 20px; display: flex; align-items: center; justify-content: center; } .mem-front { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); color: white; font-size: 2.5rem; } .mem-back { background: white; transform: rotateY(180deg); padding: 5px; } .mem-back img { width: 100%; height: 100%; object-fit: cover; border-radius: 15px; }
        
        /* Rhythm Game Fixes */
        #rhythm-canvas { width: 100%; height: 350px; background: rgba(255,255,255,0.6); border-radius: 25px; position: relative; overflow: hidden; border: 3px solid white; box-shadow: inset 0 0 20px rgba(0,0,0,0.05); } .falling-heart { position: absolute; font-size: 3rem; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2)); } 
        .hit-feedback { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); font-size: 3.5rem; font-weight: 800; pointer-events: none; opacity: 0; text-shadow: 0 3px 10px rgba(0,0,0,0.2); }
        /* FIXED ANIMATION: Ensure it ends at opacity 0 */
        @keyframes popMsg { 
            0% { transform: translate(-50%,-50%) scale(0.5); opacity: 0; } 
            20% { transform: translate(-50%,-50%) scale(1.2); opacity: 1; }
            80% { transform: translate(-50%,-120%) scale(1); opacity: 1; }
            100% { transform: translate(-50%,-150%) scale(0.8); opacity: 0; } 
        }

        .final-card { background: linear-gradient(135deg, #fff0f3, #ffe6e6); min-height: 60vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; } .final-text p { opacity: 0; transform: translateY(25px); font-size: 1.3rem; font-family: var(--font-head); margin: 12px 0; color: #d63031; font-weight: 600; text-shadow: 0 2px 0 rgba(255,255,255,0.8); } .final-text p.show { opacity: 1; transform: translateY(0); transition: 1s cubic-bezier(0.34, 1.56, 0.64, 1); } .lightbox { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 3000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); } .lightbox img { max-width: 95%; max-height: 80vh; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
    </style>
</head>
<body class="morning-mode"> 

    <div class="bg-scene bg-morning">
        <div class="sun-container"><div class="sun"></div></div>
        <div class="cloud" style="top:10%; width:120px; height:40px; animation-duration:25s;"></div>
        <div class="cloud" style="top:25%; width:180px; height:50px; animation-duration:35s; animation-delay:-10s;"></div>
        </div>
    <div class="bg-scene bg-night">
        </div>

    <canvas id="particle-canvas"></canvas>
    <audio id="bg-music" loop><source src="https://raw.githubusercontent.com/Rvenhub/i-love-u/main/scrubb%20-%20‡∏£‡∏≠‡∏¢‡∏¢‡∏°%20(official%20music%20video).mp3" type="audio/mpeg"></audio>

    <div id="instruction-modal" class="overlay">
        <div class="overlay-box">
            <div style="font-size:3.5rem; margin-bottom:15px;" id="inst-icon">üí°</div>
            <h2 id="inst-title" style="margin:0 0 10px;">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h2>
            <p id="inst-text" style="color:#666; margin-bottom:30px; font-size:1.1rem; line-height:1.6;">...</p>
            <button class="btn" onclick="closeInstruction()">‡πÇ‡∏≠‡πÄ‡∏Ñ! ‡∏•‡∏∏‡∏¢‡πÄ‡∏•‡∏¢ üöÄ</button>
        </div>
    </div>

    <div id="app" class="container">

        <section id="page-intro" class="page active">
            <div style="min-height: 70vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">
                <span style="font-size: 7rem; text-shadow: 0 10px 40px rgba(255,100,100,0.4); animation: float 3s infinite;">üéÅ</span>
                <h1 id="intro-title" style="margin-top: 30px; line-height: 1.5; font-size: 2.8rem;">‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå‡∏ô‡∏∞‡πÄ‡∏°‡∏¢‡πå! üíñ</h1>
                <p style="font-size: 1.2rem; color: #fff; text-shadow: 0 2px 5px rgba(0,0,0,0.2);">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏∞</p>
                
                <div class="theme-selector">
                    <button class="theme-btn btn-morning" onclick="setTheme('morning')">
                        <span style="font-size:2.5rem; display:block;">üåû</span> ‡πÄ‡∏ä‡πâ‡∏≤‡∏™‡∏î‡πÉ‡∏™
                    </button>
                    <button class="theme-btn btn-night" onclick="setTheme('night')">
                        <span style="font-size:2.5rem; display:block;">üåå</span> ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏ß‡∏Å‡∏≤‡∏®
                    </button>
                </div>
            </div>
        </section>

        <section id="page-timeline" class="page">
            <h2>‚è≥ ‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å</h2>
            <div class="timeline">
                <div class="timeline-item">
                    <h3>üëÄ ‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠‡∏Å‡∏±‡∏ô</h3>
                    <img src="https://github.com/Rvenhub/i-love-u/blob/main/1.jpg?raw=true" class="timeline-img">
                    <p style="margin-top:15px">"‡∏à‡∏≥‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡πâ‡∏ô... ‡πÄ‡∏ö‡∏™‡πÅ‡∏≠‡∏ö‡∏°‡∏≠‡∏á‡πÄ‡∏°‡∏¢‡πå‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏¢‡∏ô‡∏∞"</p>
                </div>
                <div class="timeline-item">
                    <h3>üê± ‡πÄ‡∏î‡∏ó‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà‡πÅ‡∏°‡∏ß</h3>
                    <img src="https://github.com/Rvenhub/i-love-u/blob/main/7.jpg?raw=true" class="timeline-img">
                    <p style="margin-top:15px">"‡πÄ‡∏°‡∏¢‡πå‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡∏ß‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏°‡∏≤‡∏Å (‡πÅ‡∏ï‡πà‡∏Å‡∏¥‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡∏à‡∏ô‡πÅ‡∏Å‡πâ‡∏°‡∏õ‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏¢ 555)"</p>
                </div>
                <div class="timeline-item">
                    <h3>üçû ‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡πâ‡∏ô</h3>
                    <p>"‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏õ‡∏¥‡πâ‡∏á‡∏≠‡∏£‡πà‡∏≠‡∏¢ ‡πÅ‡∏ï‡πà‡∏ó‡∏µ‡πà‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ‡∏Å‡∏¥‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏ò‡∏≠"</p>
                </div>
            </div>
            <button class="btn" onclick="navigateTo('page-gallery')">‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏õ‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏Å‡∏±‡∏ô üëâ</button>
        </section>

        <section id="page-gallery" class="page">
            <h2>üì∑ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h2>
            
            <div class="card" style="padding:0; overflow:hidden; height:400px; border:none;">
                <iframe src="https://padlet.com/embed/qt81x7v8qsaw7fi5" style="width:100%;height:100%;border:none;"></iframe>
            </div>

            <div class="card">
                <h3>üìÇ ‡∏≠‡∏±‡∏õ‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏¥‡πà‡∏° (‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)</h3>
                <input type="file" id="img-upload" accept="image/*" onchange="handleImageUpload(this)" style="margin: 10px 0;">
                <div class="gallery-grid" id="gallery-container"></div>
            </div>

            <button id="gallery-next-btn" class="btn btn-locked" onclick="alert('‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏™‡∏±‡∏Å 1 ‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡πâ‡∏≤‡∏≤ ü•∫')">‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞ üîí</button>
        </section>

        <section id="page-game-menu" class="page">
            <h2>üéÆ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡πÉ‡∏à</h2>
            <p style="text-align:center; margin-bottom:20px;">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á 2 ‡πÄ‡∏Å‡∏° ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ!</p>
            <div class="game-menu-item" id="menu-memory" onclick="navigateTo('page-game-memory')">
                <div style="display:flex; align-items:center;">
                    <div class="game-icon">üß†</div>
                    <div><h3 style="margin:0; text-align:left;">‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏π‡∏õ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h3><span style="font-size:0.9rem; color:#888;">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥</span></div>
                </div>
                <div class="game-status"><i class="far fa-circle"></i></div>
            </div>
            <div class="game-menu-item" id="menu-rhythm" onclick="navigateTo('page-game-rhythm')">
                <div style="display:flex; align-items:center;">
                    <div class="game-icon">üéµ</div>
                    <div><h3 style="margin:0; text-align:left;">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏´‡∏±‡∏ß‡πÉ‡∏à</h3><span style="font-size:0.9rem; color:#888;">‡∏Å‡∏î‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡πÄ‡∏û‡∏•‡∏á</span></div>
                </div>
                <div class="game-status"><i class="far fa-circle"></i></div>
            </div>
            <button id="hub-next-btn" class="btn btn-locked" onclick="checkAllGames()">‡∏¢‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡πÄ‡∏•‡∏¢ üîí</button>
        </section>

        <section id="page-game-memory" class="page">
            <h2>üß† ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏π‡∏õ</h2>
            <div class="card" style="position: relative; min-height: 450px;">
                <div id="memory-start-overlay" class="result-overlay show" style="background:rgba(255,255,255,0.9);">
                    <h3>‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÑ‡∏´‡∏°?</h3>
                    <p>‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏π‡πà‡πÄ‡∏•‡∏¢‡∏ô‡∏∞</p>
                    <button class="btn" onclick="startMemoryGameReal()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°!</button>
                </div>
                <div class="memory-grid" id="memory-board"></div>
                <div id="memory-result" class="result-overlay">
                    <h1 style="font-size:4rem; margin:0;">üéâ</h1>
                    <h3>‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å!</h3>
                    <button class="btn" onclick="finishGame('memory')">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏Å‡∏° ‚úÖ</button>
                </div>
            </div>
            <button class="btn btn-outline" onclick="navigateTo('page-game-menu')">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        </section>

        <section id="page-game-rhythm" class="page">
            <h2>üéµ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏´‡∏±‡∏ß‡πÉ‡∏à</h2>
            <p style="text-align:center;">‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ: <span id="heart-count" style="font-weight:bold; color:var(--primary-dark); font-size:1.2rem;">0</span>/20</p>
            <div class="card" style="position:relative; padding:15px;">
                <div id="rhythm-canvas">
                    <div class="beat-line" style="position:absolute; bottom:60px; width:100%; height:5px; background:#ff8fa3; box-shadow:0 0 15px #ff8fa3;"></div>
                    <div id="hit-msg" class="hit-feedback"></div>
                </div>
                <div style="text-align:center; margin-top:20px;">
                    <button id="rhythm-btn" class="btn" style="width:100px; height:100px; border-radius:50%; font-size:3rem; display:inline-flex; align-items:center; justify-content:center; box-shadow: 0 10px 30px rgba(255, 71, 126, 0.5);">ü©∑</button>
                </div>
                <div id="rhythm-result" class="result-overlay">
                    <h1 style="font-size:4rem; margin:0;">üéµ</h1>
                    <h3>‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î!</h3>
                    <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="final-score" style="font-weight:bold; font-size:1.5rem;">0</span></p>
                    <button class="btn" onclick="finishGame('rhythm')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏• & ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π ‚úÖ</button>
                </div>
            </div>
            <button id="rhythm-start-btn" class="btn" onclick="startGameRhythm()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
            <button class="btn btn-outline" onclick="navigateTo('page-game-menu')">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        </section>

        <section id="page-quiz" class="page">
            <h2>‚ùì ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ß‡∏±‡∏î‡πÉ‡∏à</h2>
            <div class="quiz-progress" id="quiz-progress"></div>
            <div class="card">
                <div id="quiz-container"></div>
                <p id="quiz-feedback" style="text-align:center; font-weight:bold; height:20px; color:var(--primary-dark); margin-top:10px;"></p>
            </div>
            <button id="quiz-next-btn" class="btn hidden" onclick="nextQuestion()">‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ üëâ</button>
            <button id="quiz-finish-btn" class="btn hidden" onclick="navigateTo('page-message')">‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡πâ‡∏≤ üíå</button>
        </section>

        <section id="page-message" class="page">
            <div class="card final-card">
                <div style="font-size:5rem; margin-bottom:20px; animation: float 3s infinite;">üß∏üíñ</div>
                <div id="final-content" class="final-text"></div>
            </div>
            <button class="btn" onclick="navigateTo('page-intro')">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        </section>

        <section id="page-settings" class="page">
            <h2>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h2>
            <div class="card">
                <p>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏û‡∏•‡∏á:</p> <input type="file" accept=".mp3" onchange="changeMusic(this)">
                <br><br>
                <button class="btn btn-outline" onclick="clearData()" style="color:red; border-color:red;">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>
            <button class="btn" onclick="navigateTo('page-intro')">‡∏Å‡∏•‡∏±‡∏ö</button>
        </section>

    </div>

    <div class="music-player">
        <div id="album-art" class="player-disc"><div class="disc-inner"></div></div>
        <div class="player-info">
            <div id="track-name" class="track-name">‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏°</div>
            <div class="track-artist">scrubb</div>
        </div>
        <div class="visualizer stopped" id="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
        <button class="play-btn" onclick="togglePlay()"><i id="play-icon" class="fas fa-play"></i></button>
    </div>

    <div id="lightbox" class="lightbox" onclick="if(event.target===this) this.style.display='none'"><img id="lightbox-img" src=""></div>

    <script>
        // --- DATA ---
        const audio = document.getElementById('bg-music');
        let isPlaying = false, currentTheme = 'morning';
        let gameStatus = { memory: false, rhythm: false };
        let galleryUnlocked = false;

        const instructions = {
            'page-timeline': { icon: '‚è≥', title: '‡∏¢‡πâ‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤', text: '‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏î‡∏π‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏ô‡∏∞' },
            'page-gallery': { icon: 'üì∏', title: '‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà', text: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà‡∏Å‡πà‡∏≠‡∏ô 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏ô‡∏∞!' },
            'page-game-menu': { icon: 'üéÆ', title: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Ñ‡∏π‡πà‡∏£‡∏±‡∏Å', text: '‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á 2 ‡πÄ‡∏Å‡∏° ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ!' },
            'page-game-memory': { icon: 'üß†', title: '‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏π‡∏õ', text: '‡∏´‡∏≤‡∏Ñ‡∏π‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡πÉ‡∏ö!' },
            'page-game-rhythm': { icon: 'üéµ', title: '‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏´‡∏±‡∏ß‡πÉ‡∏à', text: '‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ü©∑ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏´‡∏•‡πà‡∏ô‡∏•‡∏á‡∏°‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏™‡πâ‡∏ô (‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 20 ‡∏î‡∏ß‡∏á)' },
            'page-quiz': { icon: '‚ùì', title: '‡∏ß‡∏±‡∏î‡πÉ‡∏à', text: '‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡∏ô‡∏∞ ‡∏´‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≤‡∏°!' },
            'page-message': { icon: 'üíå', title: '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡πÉ‡∏à', text: '‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏≠‡πà‡∏≤‡∏ô‡∏ô‡∏∞ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÉ‡∏à‡πÄ‡∏•‡∏¢' }
        };

        // --- THEME ---
        function setTheme(theme) {
            currentTheme = theme;
            document.body.className = theme + '-mode';
            if(theme === 'morning') spawnBirdsFinal(); else spawnShootingStarsFinal();
            initParticles(); startApp();
        }

        function spawnBirdsFinal() {
            document.querySelectorAll('.bird-final').forEach(e => e.remove());
            setInterval(() => {
                if(currentTheme !== 'morning') return;
                const b = document.createElement('div'); b.className = 'bird-final'; b.innerHTML = Math.random()>0.5 ? 'üïäÔ∏è' : 'üê¶';
                const direction = Math.random() > 0.5 ? 'Right' : 'Left';
                const startY = Math.random() * 50 + 5 + '%';
                const duration = Math.random() * 5 + 15 + 's';
                b.style.setProperty('--startY', startY);
                b.style.animation = `fly${direction}Wavy ${duration} linear forwards`;
                document.querySelector('.bg-morning').appendChild(b);
                setTimeout(() => b.remove(), 20000);
            }, 3500);
        }

        function spawnShootingStarsFinal() {
            document.querySelectorAll('.shooting-star-final').forEach(e => e.remove());
            setInterval(() => {
                if(currentTheme !== 'night') return;
                const s = document.createElement('div'); s.className = 'shooting-star-final';
                const startX = (Math.random() * 50 - 25) + '%'; 
                const startY = (Math.random() * 50 - 25) + '%';
                const angle = (Math.random() * 30 + 30) + 'deg';
                const duration = Math.random() * 1.5 + 1 + 's';
                const colors = ['#fff', '#a1c4fd', '#ff9a9e'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                s.style.setProperty('--startX', startX);
                s.style.setProperty('--startY', startY);
                s.style.setProperty('--angle', angle);
                s.style.color = color;
                s.style.animation = `shootAcrossScreen ${duration} ease-out forwards`;
                document.querySelector('.bg-night').appendChild(s); 
                setTimeout(() => s.remove(), 3000);
            }, 1200);
        }

        window.onload = () => {
            document.body.classList.add('morning-mode');
            initParticles(); loadGallery();
            typeWriter("‡πÄ‡∏Ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏°‡∏≤‡∏ù‡∏≤‡∏Å üíñ", "intro-title", 80);
        };

        function typeWriter(txt, id, spd) {
            let i = 0; document.getElementById(id).innerHTML = "";
            function type() { if(i<txt.length) { document.getElementById(id).innerHTML += txt.charAt(i); i++; setTimeout(type, spd); } } type();
        }

        // --- NAVIGATION ---
        function startApp() { initAudio(); navigateTo('page-timeline'); }
        function navigateTo(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
            
            if(instructions[id]) showInstruction(instructions[id]);

            if(id === 'page-game-menu') updateGameMenuUI();
            if(id === 'page-game-memory') document.getElementById('memory-start-overlay').style.display = 'flex';
            if(id === 'page-game-rhythm') initRhythmGame();
            if(id === 'page-message') playFinalAnimation();
        }
        function showInstruction(d) {
            document.getElementById('inst-icon').innerText = d.icon;
            document.getElementById('inst-title').innerText = d.title;
            document.getElementById('inst-text').innerText = d.text;
            document.getElementById('instruction-modal').style.display = 'flex';
        }
        function closeInstruction() { document.getElementById('instruction-modal').style.display = 'none'; }

        // --- AUDIO ---
        function initAudio() { audio.volume = 0.5; audio.play().then(()=>{isPlaying=true;updatePlayerUI();}).catch(()=>{}); }
        function togglePlay() { if(audio.paused){audio.play();isPlaying=true;}else{audio.pause();isPlaying=false;} updatePlayerUI(); }
        function updatePlayerUI() {
            const i = document.getElementById('play-icon'), d = document.getElementById('album-art'), v = document.getElementById('visualizer');
            if(isPlaying) { i.className='fas fa-pause'; d.classList.add('playing'); v.classList.remove('stopped'); }
            else { i.className='fas fa-play'; d.classList.remove('playing'); v.classList.add('stopped'); }
        }
        function changeMusic(inp) {
            if(inp.files[0]) { audio.src = URL.createObjectURL(inp.files[0]); document.getElementById('track-name').innerText = inp.files[0].name; audio.play(); isPlaying=true; updatePlayerUI(); }
        }

        // --- GALLERY ---
        const cloudImages = [
            {src:"https://github.com/Rvenhub/i-love-u/blob/main/6.jpg?raw=true"},
            {src:"https://github.com/Rvenhub/i-love-u/blob/main/5.jpg?raw=true"},
            {src:"https://github.com/Rvenhub/i-love-u/blob/main/4.jpg?raw=true"},
            {src:"https://github.com/Rvenhub/i-love-u/blob/main/3.jpg?raw=true"}
        ];
        let localImages = [];
        function loadGallery() {
            const stored = localStorage.getItem('may_gallery'); if(stored) localImages = JSON.parse(stored); renderGallery();
        }
        function renderGallery() {
            const c = document.getElementById('gallery-container'); c.innerHTML = '';
            localImages.forEach((img,i) => c.innerHTML += `<div class="gallery-item"><img src="${img.src}" onclick="openLightbox('${img.src}')"><button class="delete-btn" onclick="deleteImg(${i})">x</button></div>`);
            cloudImages.forEach(img => c.innerHTML += `<div class="gallery-item"><img src="${img.src}" onclick="openLightbox('${img.src}')"></div>`);
        }
        function handleImageUpload(inp) {
            if(inp.files[0]) {
                const r = new FileReader(); r.onload = function(e) { localImages.unshift({src:e.target.result}); localStorage.setItem('may_gallery', JSON.stringify(localImages)); renderGallery(); }
                r.readAsDataURL(inp.files[0]);
            }
        }
        function deleteImg(i) { if(confirm("‡∏•‡∏ö?")) { localImages.splice(i,1); localStorage.setItem('may_gallery', JSON.stringify(localImages)); renderGallery(); } }
        function clearData() { if(confirm("‡∏•‡∏ö‡∏´‡∏°‡∏î?")) { localStorage.removeItem('may_gallery'); location.reload(); } }
        function openLightbox(src) {
            document.getElementById('lightbox-img').src = src; document.getElementById('lightbox').style.display = 'flex';
            if(!galleryUnlocked) { galleryUnlocked=true; const b = document.getElementById('gallery-next-btn'); b.classList.remove('btn-locked'); b.innerText = "‡πÑ‡∏õ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏Å‡∏±‡∏ô! üéÆ"; b.onclick = () => navigateTo('page-game-menu'); }
        }

        // --- GAMES ---
        function updateGameMenuUI() {
            if(gameStatus.memory) document.getElementById('menu-memory').classList.add('completed');
            if(gameStatus.rhythm) document.getElementById('menu-rhythm').classList.add('completed');
            if(gameStatus.memory && gameStatus.rhythm) { const b=document.getElementById('hub-next-btn'); b.classList.remove('btn-locked'); b.innerText="‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏õ‡∏ß‡∏±‡∏î‡πÉ‡∏à‡∏Å‡∏±‡∏ô üëâ"; b.onclick=()=>navigateTo('page-quiz'); }
        }
        function finishGame(game) { gameStatus[game] = true; navigateTo('page-game-menu'); }
        function checkAllGames() { if(!gameStatus.memory || !gameStatus.rhythm) alert("‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á 2 ‡πÄ‡∏Å‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡πâ‡∏≤‡∏≤ ü•∫"); }

        // --- GAME 1 ---
        let flipped = [], matches = 0;
        function startMemoryGameReal() { document.getElementById('memory-start-overlay').style.display = 'none'; initMemoryGame(); }
        function initMemoryGame() {
            const b = document.getElementById('memory-board'); b.innerHTML = ''; flipped = []; matches = 0;
            document.getElementById('memory-result').style.display = 'none';
            let imgs = [...cloudImages]; while(imgs.length<6) imgs = imgs.concat(cloudImages); imgs = imgs.slice(0,6);
            let deck = [...imgs, ...imgs].sort(()=>0.5-Math.random());
            deck.forEach(img => {
                const c = document.createElement('div'); c.className = 'memory-card';
                c.innerHTML = `<div class="memory-inner"><div class="mem-face mem-front">üß∏</div><div class="mem-face mem-back"><img src="${img.src}"></div></div>`;
                c.onclick = () => { if(flipped.length<2 && !c.classList.contains('flipped')) { c.classList.add('flipped'); flipped.push({el:c, src:img.src}); if(flipped.length===2) checkMemMatch(); } };
                b.appendChild(c);
            });
        }
        function checkMemMatch() {
            const [c1, c2] = flipped;
            if(c1.src === c2.src) { matches++; flipped = []; if(matches===6) setTimeout(()=>document.getElementById('memory-result').style.display='flex', 500); }
            else setTimeout(() => { c1.el.classList.remove('flipped'); c2.el.classList.remove('flipped'); flipped = []; }, 800);
        }

        // --- GAME 2 (FIXED) ---
        let rScore=0, rCount=0, rInterval, isRPlaying=false;
        function initRhythmGame() {
            isRPlaying = false; clearInterval(rInterval); document.getElementById('rhythm-start-btn').classList.remove('hidden'); document.getElementById('rhythm-result').style.display = 'none';
            document.querySelectorAll('.falling-heart').forEach(e=>e.remove()); document.getElementById('heart-count').innerText = "0/20"; document.getElementById('rhythm-btn').disabled = true;
        }
        function startGameRhythm() {
            initRhythmGame(); isRPlaying = true; rScore=0; rCount=0;
            document.getElementById('rhythm-start-btn').classList.add('hidden'); document.getElementById('rhythm-btn').disabled = false;
            let spawned=0; rInterval = setInterval(() => { if(!isRPlaying) return; if(spawned<20) { spawnHeart(); spawned++; } else clearInterval(rInterval); }, 1000);
            document.getElementById('rhythm-btn').onclick = checkRhythmHit;
        }
        function spawnHeart() {
            const h = document.createElement('div'); h.className = 'falling-heart'; h.innerHTML = currentTheme === 'night' ? '‚≠ê' : '‚ù§Ô∏è';
            h.style.left = Math.random()*80+10+'%'; h.style.top = '-50px';
            document.getElementById('rhythm-canvas').appendChild(h);
            let pos=-50, fall=setInterval(() => { if(!isRPlaying){clearInterval(fall);h.remove();return;} pos+=4; h.style.top=pos+'px'; if(pos>320){clearInterval(fall);h.remove();showFeedback("MISS","#ccc");checkRhythmEnd();} },20);
            h.dataset.timer = fall;
        }
        function checkRhythmHit() {
            if(!isRPlaying) return; let hit = false;
            document.querySelectorAll('.falling-heart').forEach(h => {
                if(hit) return; let top = parseInt(h.style.top);
                if(top>200 && top<300) { hit=true; clearInterval(h.dataset.timer); h.remove(); rCount++; rScore+=100; document.getElementById('heart-count').innerText = rCount+"/20"; showFeedback("PERFECT!", "#ff4d6d"); checkRhythmEnd(); }
            });
        }
        // Fixed: Reset animation to allow replay
        function showFeedback(t,c) { 
            const e = document.getElementById('hit-msg'); 
            e.innerText = t; e.style.color = c; 
            e.style.animation = 'none'; 
            e.offsetHeight; /* Trigger Reflow */ 
            e.style.animation = 'popMsg 0.5s ease-out forwards'; 
        }
        function checkRhythmEnd() { if(rCount>=10) { document.getElementById('final-score').innerText=rScore; document.getElementById('rhythm-result').style.display='flex'; isRPlaying=false; } }

        // --- QUIZ (LOCKED) ---
        const qData = [{q:"‡πÄ‡∏°‡∏¢‡πå‡∏ä‡∏≠‡∏ö‡∏Å‡∏¥‡∏ô‡∏≠‡∏∞‡πÑ‡∏£?", a:["‡∏Ç‡πâ‡∏≤‡∏ß‡∏ï‡πâ‡∏°","‡∏Ç‡∏ô‡∏°","‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î","‡∏ú‡∏•‡πÑ‡∏°‡πâ"], c:1}, {q:"‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö?", a:["‡∏ä‡∏°‡∏û‡∏π","‡∏°‡πà‡∏ß‡∏á","‡∏Ç‡∏≤‡∏ß","‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß"], c:0}, {q:"‡πÄ‡∏î‡∏ó‡πÅ‡∏£‡∏Å?", a:["‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà‡πÅ‡∏°‡∏ß","‡πÇ‡∏£‡∏á‡∏´‡∏ô‡∏±‡∏á","‡∏™‡∏ß‡∏ô","‡∏´‡πâ‡∏≤‡∏á"], c:0}, {q:"‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á?", a:["‡πÅ‡∏°‡∏ß","‡∏´‡∏°‡∏≤","‡∏ô‡∏Å","‡∏õ‡∏•‡∏≤"], c:0}];
        let qIdx = 0;
        function nextQuestion() {
            if(qIdx>=qData.length) return;
            const d = qData[qIdx];
            document.getElementById('quiz-progress').innerHTML = qData.map((_, i) => `<div class="progress-dot ${i===qIdx ? 'active' : ''} ${i<qIdx ? 'done' : ''}"></div>`).join('');
            document.getElementById('quiz-container').innerHTML = `<h3 style="margin-bottom:20px;">${qIdx+1}. ${d.q}</h3>${d.a.map((ans,i) => `<div class="quiz-option" onclick="checkQuiz(${i}, this)">${ans}</div>`).join('')}`;
            document.getElementById('quiz-feedback').innerText = ""; document.getElementById('quiz-next-btn').classList.add('hidden');
        }
        function checkQuiz(i, el) {
            document.querySelectorAll('.quiz-option').forEach(o => o.style.pointerEvents='none');
            if(i===qData[qIdx].c) { el.classList.add('correct'); document.getElementById('quiz-feedback').innerText="‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! üíï"; confettiEffect(); }
            else { el.classList.add('wrong'); document.getElementById('quiz-feedback').innerText="‡∏ú‡∏¥‡∏î‡∏á‡πà‡∏∞ üòú"; }
            qIdx++; if(qIdx<qData.length) document.getElementById('quiz-next-btn').classList.remove('hidden'); else document.getElementById('quiz-finish-btn').classList.remove('hidden');
        }
        nextQuestion();

        // --- FINAL ---
        function playFinalAnimation() {
            const lines = ["‡∏ñ‡∏∂‡∏á... ‡πÄ‡∏°‡∏¢‡πå‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á üíñ", "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ô‡∏à‡∏ö‡∏ô‡∏∞", "‡∏≠‡∏¢‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤ '‡∏£‡∏±‡∏Å' ‡∏Ñ‡∏≥‡πÄ‡∏î‡∏µ‡∏¢‡∏ß", "‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏¢‡πå‡∏ó‡∏≥‡πÉ‡∏´‡πâ", "‡∏î‡∏µ‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏¢‡πå‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏ô‡∏∞", "‡∏à‡∏∞‡∏î‡∏π‡πÅ‡∏•‡πÉ‡∏´‡πâ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏•‡∏¢", "‡∏£‡∏±‡∏Å‡∏ô‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡∏°‡∏õ‡πà‡∏≠‡∏á! üíï"];
            const c = document.getElementById('final-content'); c.innerHTML = "";
            lines.forEach((l,i) => { const p=document.createElement('p'); p.innerText=l; c.appendChild(p); setTimeout(()=>p.classList.add('show'), i*1200); });
        }

        // --- PARTICLES ---
        function initParticles() {
            const c = document.getElementById('particle-canvas'), x = c.getContext('2d');
            c.width = window.innerWidth; c.height = window.innerHeight;
            const p = Array(40).fill().map(() => ({x: Math.random()*c.width, y: Math.random()*c.height, s: Math.random()*2+1, o: Math.random()}));
            function loop() {
                x.clearRect(0,0,c.width,c.height); x.fillStyle = currentTheme==='night' ? '#ffffff' : '#ff7eb3';
                p.forEach(o => { if(currentTheme==='night') o.o += (Math.random()-0.5)*0.1; if(o.o<0)o.o=0; if(o.o>1)o.o=1; x.globalAlpha=o.o; x.beginPath(); x.arc(o.x, o.y, o.s, 0, Math.PI*2); x.fill(); });
                requestAnimationFrame(loop);
            }
            loop();
        }
        
        function confettiEffect() {
            for(let i=0; i<20; i++) {
                const c = document.createElement('div');
                c.style.position='fixed'; c.style.left=Math.random()*100+'vw'; c.style.top='-10px';
                c.style.width='8px'; c.style.height='8px'; c.style.backgroundColor=['#ff0','#0f0','#00f'][Math.floor(Math.random()*3)];
                c.style.zIndex='9999'; c.style.transition='top 1s';
                document.body.appendChild(c);
                setTimeout(()=>{c.style.top='100vh';},10); setTimeout(()=>{c.remove()},1000);
            }
        }
        
        window.addEventListener('resize', initParticles);
    </script>
</body>
</html>
