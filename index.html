<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå‡∏ô‡∏∞‡πÄ‡∏°‡∏¢‡πå! üíñ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- 1. VARIABLES --- */
        :root {
            --primary: #ff9a9e;
            --primary-grad: linear-gradient(135deg, #ff9a9e, #fad0c4);
            --primary-dark: #ff6b81;
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: 2px solid rgba(255, 255, 255, 0.9);
            --font-head: 'Mali', cursive;
            --font-body: 'Prompt', sans-serif;
            --bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        /* CUSTOM CURSOR & BODY */
        body {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="%23ff6b81"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>') 12 12, auto;
            margin: 0; padding: 0;
            font-family: var(--font-body);
            color: #555;
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 140px;
            background: #333;
            transition: background 1s ease;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* NOISE & VIGNETTE */
        .noise-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
            pointer-events: none; z-index: 9000;
        }
        .vignette {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 60%, rgba(255, 154, 158, 0.15) 100%);
            pointer-events: none; z-index: 9001;
            animation: breatheVignette 4s infinite alternate;
        }
        @keyframes breatheVignette { 0% { opacity: 0.5; } 100% { opacity: 1; } }

        /* PAGE TRANSITION FLASH */
        #page-transition {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 20000; pointer-events: none;
            opacity: 0; transition: opacity 0.5s ease;
        }
        #page-transition.active { opacity: 1; pointer-events: all; }

        /* --- 2. BACKGROUND SCENES --- */
        .bg-scene { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; transition: opacity 1.5s ease; opacity: 0; pointer-events: none; overflow: hidden; }
        
        /* Morning */
        body.morning-mode .bg-morning { opacity: 1; }
        .bg-morning { background: linear-gradient(180deg, #89f7fe 0%, #66a6ff 100%); }
        .sun { position: absolute; top: 10%; right: 10%; width: 120px; height: 120px; background: radial-gradient(circle, #fffacd 30%, #ffd700 100%); border-radius: 50%; box-shadow: 0 0 60px #ffd700; animation: sunPulse 4s infinite alternate; }
        @keyframes sunPulse { 0% { transform: scale(1); box-shadow: 0 0 50px #ffd700; } 100% { transform: scale(1.1); box-shadow: 0 0 80px #ffeb3b; } }
        .cloud { position: absolute; background: rgba(255,255,255,0.8); border-radius: 50px; animation: moveCloud linear infinite; filter: blur(8px); }
        @keyframes moveCloud { from { transform: translateX(-20vw); } to { transform: translateX(120vw); } }
        
        /* Night */
        body.night-mode .bg-night { opacity: 1; }
        body.night-mode { color: #f0f0f0; } 
        body.night-mode h1, body.night-mode h2 { color: #ffcae5; text-shadow: 0 0 15px rgba(255,100,150,0.8); }
        .bg-night { background: linear-gradient(to bottom, #090b1a, #161a38, #261c2c); }
        .shooting-star-v3 { position: absolute; height: 2px; background: linear-gradient(90deg, #fff, transparent); border-radius: 50%; opacity: 0; filter: drop-shadow(0 0 5px #fff); transform-origin: left center; }
        .shooting-star-v3::before { content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 4px; height: 4px; background: #fff; border-radius: 50%; box-shadow: 0 0 10px #fff, 0 0 20px #fff; }
        @keyframes shootAcrossV3 { 0% { opacity: 0; transform: translate(0, 0) rotate(45deg) scale(0.5); } 10% { opacity: 1; } 100% { opacity: 0; transform: translate(150vw, 150vh) rotate(45deg) scale(1); } }

        /* Pastel */
        body.pastel-mode .bg-pastel { opacity: 1; }
        .bg-pastel { background: linear-gradient(135deg, #ffe0e9 0%, #ffb7c5 100%); }
        .mixed-floater { position: absolute; bottom: -50px; animation: floatUpMixed linear infinite; will-change: transform, opacity; z-index: -1; }
        @keyframes floatUpMixed { 0% { transform: translateY(0) rotate(0deg) scale(0.5); opacity: 0; } 20% { opacity: 0.8; } 80% { opacity: 0.6; } 100% { transform: translateY(-110vh) rotate(360deg) scale(1); opacity: 0; } }

        /* Birds */
        .bird-final { position: absolute; font-size: 24px; z-index: -1; will-change: transform; top: var(--startY); }
        @keyframes flyRightWavy { 0% { transform: translateX(-10vw) translateY(0) scaleX(1); } 50% { transform: translateX(60vw) translateY(0) scaleX(1); } 100% { transform: translateX(120vw) translateY(0) scaleX(1); } }
        @keyframes flyLeftWavy { 0% { transform: translateX(110vw) translateY(0) scaleX(-1); } 50% { transform: translateX(50vw) translateY(0) scaleX(-1); } 100% { transform: translateX(-10vw) translateY(0) scaleX(-1); } }

        canvas#particle-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }

        /* --- 3. UI ANIMATIONS --- */
        .reveal-element { opacity: 0; transform: translateY(30px) scale(0.95); filter: blur(5px); transition: all 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .reveal-element.visible { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }

        /* Typewriter Cursor */
        .typing-cursor::after { content: '|'; animation: blink 1s infinite; color: var(--primary-dark); margin-left: 2px; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* --- 4. LAYOUT & CARDS --- */
        .container { max-width: 550px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }
        .page { display: none; } .page.active { display: block; }

        .card, .timeline-item {
            background: var(--glass-bg); backdrop-filter: blur(30px); border-radius: 35px;
            border: var(--glass-border); padding: 30px; margin-bottom: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.08); transition: transform 0.4s var(--bounce);
        }
        body.night-mode .card, body.night-mode .timeline-item { background: rgba(30, 30, 50, 0.6); border: 1px solid rgba(255,255,255,0.15); }

        h1, h2, h3 { font-family: var(--font-head); color: #ff6b81; text-align: center; margin-bottom: 15px; }
        h1 { font-size: 2.8rem; text-shadow: 3px 3px 0 rgba(255,255,255,0.7); }
        p { line-height: 1.8; font-size: 1.05rem; margin-bottom: 10px; }

        /* Soft Buttons */
        .btn {
            font-family: var(--font-head); background: var(--primary-grad); color: #fff; border: none; padding: 18px 30px;
            border-radius: 50px; font-size: 1.2rem; font-weight: 700;
            cursor: pointer; width: 100%; margin-top: 15px;
            box-shadow: 0 8px 20px rgba(255, 118, 117, 0.4), inset 0 2px 0 rgba(255,255,255,0.4);
            transition: all 0.3s var(--bounce); position: relative; overflow: hidden; transform: scale(1);
        }
        .btn:hover { transform: scale(1.05) translateY(-3px); box-shadow: 0 15px 30px rgba(255, 118, 117, 0.6), inset 0 2px 0 rgba(255,255,255,0.4); }
        .btn:active { transform: scale(0.95); }
        .btn-outline { background: white; color: #ff6b81; border: 3px solid #ff9a9e; box-shadow: none; }
        .btn-locked { background: #dcdcdc !important; color: #aaa !important; box-shadow: inset 0 2px 0 rgba(255,255,255,0.5) !important; cursor: not-allowed; transform: none !important; }

        .theme-selector { display: flex; gap: 10px; margin-top: 30px; flex-wrap: wrap; }
        .theme-btn { flex: 1 1 30%; padding: 15px 5px; border-radius: 20px; border: none; cursor: pointer; transition: 0.3s; font-family: var(--font-head); font-weight: bold; font-size: 0.9rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-morning { background: linear-gradient(135deg, #89f7fe, #66a6ff); color: white; }
        .btn-night { background: linear-gradient(135deg, #30cfd0, #330867); color: white; }
        .btn-pastel { background: linear-gradient(135deg, #ff9a9e, #ffdde1); color: white; }
        .theme-btn:hover { transform: translateY(-5px); }

        /* Components */
        .timeline { padding-left: 20px; border-left: 4px dotted rgba(255,255,255,0.8); margin-left: 10px; } .timeline-item::before { content: '‚ù§Ô∏è'; position: absolute; left: -44px; top: 25px; background: white; border-radius: 50%; padding: 8px; font-size: 1.1rem; box-shadow: 0 5px 15px rgba(0,0,0,0.1); } .timeline-img { width: 100%; max-height: 350px; object-fit: cover; border-radius: 25px; margin-top: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); transition: transform 0.5s ease; }
        .timeline-img:hover { transform: perspective(1000px) rotateX(5deg) rotateY(-5deg) scale(1.02); }

        .gallery-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; } .gallery-item { position: relative; aspect-ratio: 1/1; border-radius: 20px; background: white; padding: 6px; cursor: pointer; transition: 0.4s; box-shadow: 0 5px 15px rgba(0,0,0,0.05); } .gallery-item:hover { transform: scale(1.05); z-index: 5; } .gallery-item img { width: 100%; height: 100%; object-fit: cover; border-radius: 16px; } .delete-btn { position: absolute; top: -5px; right: -5px; background: #ff477e; color: white; width: 30px; height: 30px; border-radius: 50%; border: none; cursor: pointer; }
        .game-menu-item { display: flex; align-items: center; justify-content: space-between; padding: 25px; background: white; border-radius: 30px; margin-bottom: 20px; cursor: pointer; border: 3px solid transparent; transition: 0.3s; box-shadow: 0 5px 20px rgba(0,0,0,0.05); } .game-menu-item:hover { border-color: #ff9a9e; transform: translateX(5px); } .game-menu-item.completed { background: #e8f5e9; border-color: #2ecc71; } .game-icon { font-size: 3rem; margin-right: 20px; background: #fff5f8; padding: 15px; border-radius: 50%; }
        
        .music-player { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 85%; max-width: 380px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); border-radius: 60px; padding: 12px 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 15px; z-index: 1000; border: 3px solid rgba(255,255,255,0.9); }
        .player-disc { width: 50px; height: 50px; border-radius: 50%; background: #222; border: 2px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.2); background-image: url('https://github.com/Rvenhub/i-love-u/blob/main/%E0%B8%9B%E0%B8%81%E0%B9%80%E0%B8%9E%E0%B8%A5%E0%B8%87.jpg?raw=true'); background-size: cover; background-position: center; animation: spin 5s linear infinite; animation-play-state: paused; } .player-disc.playing { animation-play-state: running; } @keyframes spin { 100% { transform: rotate(360deg); } } .player-info { flex: 1; overflow: hidden; } .track-name { font-weight: 700; font-size: 0.95rem; color: #333; white-space: nowrap; } .play-btn { width: 45px; height: 45px; border-radius: 50%; background: var(--primary-dark); color: white; border: none; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; box-shadow: 0 5px 15px rgba(255,71,126,0.4); transition: transform 0.2s; } .play-btn:active { transform: scale(0.9); } .visualizer { display: flex; align-items: flex-end; gap: 3px; height: 20px; margin-right: 10px; } .bar { width: 4px; background: #ff9a9e; border-radius: 4px; animation: bounce 0.6s ease-in-out infinite alternate; } .visualizer.stopped .bar { animation: none; height: 4px; } @keyframes bounce { 0% { height: 5px; } 100% { height: 100%; } }

        .quiz-progress { display: flex; gap: 8px; margin-bottom: 25px; justify-content: center; } .progress-dot { width: 12px; height: 12px; background: #eee; border-radius: 50%; transition: 0.3s; } .progress-dot.active { background: #ff9a9e; transform: scale(1.4); } .progress-dot.done { background: #2ecc71; } .quiz-option { background: white; border: 2px solid #f0f0f0; padding: 18px 25px; margin-bottom: 15px; border-radius: 20px; cursor: pointer; transition: 0.3s; font-weight: 600; display: flex; align-items: center; font-size: 1.05rem; } .quiz-option:hover { border-color: #ff9a9e; color: #ff6b81; transform: translateX(5px); } .quiz-option.correct { background: #e3f9e5; border-color: #2ecc71; color: #218c74; animation: bounceSuccess 0.5s ease; pointer-events: none; } .quiz-option.wrong { background: #ffeaea; border-color: #ff6b81; color: #c0392b; animation: shakeError 0.4s ease; } @keyframes bounceSuccess { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } } @keyframes shakeError { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); z-index: 2000; display: none; align-items: center; justify-content: center; } .overlay-box { background: white; width: 85%; max-width: 350px; padding: 40px 30px; border-radius: 40px; text-align: center; box-shadow: 0 25px 70px rgba(0,0,0,0.3); animation: zoomIn 0.4s var(--bounce); } @keyframes zoomIn { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } } .inst-icon { font-size: 4rem; margin-bottom: 15px; } .result-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.95); display: none; flex-direction: column; align-items: center; justify-content: center; border-radius: 28px; z-index: 50; padding: 20px; text-align: center; } .result-overlay.show { display: flex; animation: fadeIn 0.5s; }
        .memory-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin: 20px 0; } .memory-card { aspect-ratio: 1/1; cursor: pointer; perspective: 1000px; } .memory-inner { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: 0.6s; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); } .memory-card.flipped .memory-inner { transform: rotateY(180deg); } .mem-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 20px; display: flex; align-items: center; justify-content: center; } .mem-front { background: var(--secondary-grad); color: white; font-size: 2.5rem; } .mem-back { background: white; transform: rotateY(180deg); padding: 5px; } .mem-back img { width: 100%; height: 100%; object-fit: cover; border-radius: 15px; } #rhythm-canvas { width: 100%; height: 350px; background: rgba(255,255,255,0.6); border-radius: 25px; position: relative; overflow: hidden; border: 3px solid white; box-shadow: inset 0 0 20px rgba(0,0,0,0.05); } .falling-heart { position: absolute; font-size: 3rem; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2)); } .hit-feedback { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); font-size: 3.5rem; font-weight: 800; pointer-events: none; opacity: 0; text-shadow: 0 3px 10px rgba(0,0,0,0.2); } @keyframes popMsg { 0% { transform: translate(-50%,-50%) scale(0.5); opacity: 0; } 20% { transform: translate(-50%,-50%) scale(1.2); opacity: 1; } 80% { transform: translate(-50%,-120%) scale(1); opacity: 1; } 100% { transform: translate(-50%,-150%) scale(0.8); opacity: 0; } } .lightbox { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 3000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); } .lightbox img { max-width: 95%; max-height: 80vh; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); } .hidden { display: none !important; }

        /* --- 5. THE SUPER 3D POPUP (FINAL) --- */
        #final-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 230, 235, 0.95);
            backdrop-filter: blur(12px);
            z-index: 10000; display: none;
            flex-direction: column; align-items: center; justify-content: center;
            perspective: 1200px;
        }
        #final-overlay.show { display: flex; animation: bgFadeIn 0.5s; }
        @keyframes bgFadeIn { from { opacity: 0; } to { opacity: 1; } }

        .gift-box-trigger {
            font-size: 7rem; cursor: pointer;
            filter: drop-shadow(0 15px 30px rgba(0,0,0,0.2));
            animation: giftShake 2.5s infinite ease-in-out;
            transition: 0.3s;
        }
        .gift-box-trigger:hover { transform: scale(1.1); }
        @keyframes giftShake { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(-5deg); } 75% { transform: rotate(5deg); } }

        .final-card-popup {
            background: #fff; width: 90%; max-width: 360px;
            border-radius: 35px; padding: 40px 30px;
            text-align: center;
            box-shadow: 0 40px 100px rgba(255, 107, 129, 0.5);
            border: 5px solid #ff9a9e;
            position: relative; overflow: hidden;
            opacity: 0;
            transform: translateY(500px) rotateX(60deg) rotateY(180deg) scale(0.2);
        }

        .final-card-popup.show {
            animation: superPopEntry 1.2s cubic-bezier(0.19, 1, 0.22, 1) forwards, 
                       cardFloat 3s 1.2s ease-in-out infinite alternate;
        }

        @keyframes superPopEntry {
            0% { opacity: 0; transform: translateY(500px) rotateX(45deg) rotateY(720deg) scale(0.2); }
            60% { opacity: 1; transform: translateY(-30px) rotateX(0deg) rotateY(0deg) scale(1.05); }
            80% { transform: translateY(10px) scale(0.98); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes cardFloat { 0% { transform: translateY(0); } 100% { transform: translateY(-15px); } }
        
        .bear-emoji {
            font-size: 6rem; display: block; margin-bottom: 20px;
            animation: bearBreath 3s ease-in-out infinite;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.1));
        }
        @keyframes bearBreath { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        /* TOAST */
        .toast {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%) translateY(20px);
            background: rgba(50, 50, 50, 0.9); color: white; padding: 12px 24px; border-radius: 50px;
            font-size: 0.9rem; z-index: 12000; opacity: 0; transition: 0.3s; pointer-events: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); white-space: nowrap;
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        
        /* CLICK PARTICLES */
        .click-heart {
            position: fixed; pointer-events: none; font-size: 1.5rem;
            animation: floatUpFade 1s forwards; z-index: 9999;
        }
        @keyframes floatUpFade {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.5); opacity: 0; }
        }
        
    </style>
</head>
<body class="pastel-mode"> 

    <div class="noise-overlay"></div>
    <div class="vignette"></div>
    <div id="page-transition"></div>

    <div class="bg-scene bg-morning">
        <div class="sun-container"><div class="sun"></div></div>
        <div class="cloud" style="top:15%; width:140px; height:45px; animation-duration:28s;"></div>
        <div class="cloud" style="top:30%; width:200px; height:60px; animation-duration:40s; animation-delay:-5s;"></div>
    </div>
    <div class="bg-scene bg-night"></div>
    <div class="bg-scene bg-pastel"></div>

    <canvas id="particle-canvas"></canvas>
    <audio id="bg-music" loop><source src="https://raw.githubusercontent.com/Rvenhub/i-love-u/main/scrubb%20-%20‡∏£‡∏≠‡∏¢‡∏¢‡∏°%20(official%20music%20video).mp3" type="audio/mpeg"></audio>

    <div id="instruction-modal" class="overlay">
        <div class="overlay-box">
            <div style="font-size:3.5rem; margin-bottom:15px;" id="inst-icon">üí°</div>
            <h2 id="inst-title" style="margin:0 0 10px;">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h2>
            <p id="inst-text" style="color:#666; margin-bottom:30px; font-size:1.1rem;">...</p>
            <button class="btn" onclick="closeInstruction()">‡πÇ‡∏≠‡πÄ‡∏Ñ! ‡∏•‡∏∏‡∏¢‡πÄ‡∏•‡∏¢ üöÄ</button>
        </div>
    </div>

    <div id="final-overlay">
        <div id="card-popup" class="final-card-popup">
            <div class="bear-emoji">üß∏</div>
            <h2 style="color:#ff6b81; margin-bottom:15px;">‡∏ñ‡∏∂‡∏á... ‡πÄ‡∏°‡∏¢‡πå‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á üíñ</h2>
            <div id="popup-text" style="font-size:1.1rem; line-height:1.8; color:#555; font-weight:600; min-height:100px;"></div>
            <button class="btn" onclick="saveToHeart()" style="margin-top:20px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÉ‡∏à ‚ù§Ô∏è</button>
            <button class="btn btn-outline" onclick="closeGift()" style="margin-top:10px; font-size:0.9rem; padding:10px;">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</button>
        </div>
    </div>

    <div id="toast" class="toast">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>

    <div id="app" class="container">

        <section id="page-intro" class="page active">
            <div style="min-height: 80vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">
                <span style="font-size: 7rem; text-shadow: 0 10px 40px rgba(255,100,100,0.4); animation: float 3s infinite;">üéÅ</span>
                <h1 id="intro-title" class="reveal-element" style="margin-top: 30px; line-height: 1.5; font-size: 2.8rem;">‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå‡∏ô‡∏∞‡πÄ‡∏°‡∏¢‡πå! üíñ</h1>
                <p id="greeting-text" class="reveal-element" style="font-size: 1.2rem; margin-bottom:5px; color:var(--primary-dark); font-weight:bold;"></p>
                <p class="reveal-element" style="font-size: 1rem; color:#666;">‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≤‡∏°‡∏ô‡∏∞‚Ä¶ ‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏°‡∏¢‡πå‡∏î‡∏π‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤ ü•∫</p>
                
                <div class="theme-selector reveal-element">
                    <button class="theme-btn btn-morning" onclick="setTheme('morning', true)">üåû ‡πÄ‡∏ä‡πâ‡∏≤‡∏™‡∏î‡πÉ‡∏™</button>
                    <button class="theme-btn btn-night" onclick="setTheme('night', true)">üåå ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏ß‡∏Å‡∏≤‡∏®</button>
                    <button class="theme-btn btn-pastel" onclick="setTheme('pastel', true)">üå∏ ‡∏ä‡∏°‡∏û‡∏π‡∏´‡∏ß‡∏≤‡∏ô</button>
                </div>
            </div>
        </section>

        <section id="page-timeline" class="page">
            <h2 class="reveal-element">‚è≥ ‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å</h2>
            <div class="timeline reveal-element">
                <div class="timeline-item">
                    <h3>üëÄ ‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠‡∏Å‡∏±‡∏ô</h3>
                    <img src="https://github.com/Rvenhub/i-love-u/blob/main/1.jpg?raw=true" class="timeline-img">
                    <p style="margin-top:15px">"‡∏à‡∏≥‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡πâ‡∏ô... ‡πÄ‡∏ö‡∏™‡πÅ‡∏≠‡∏ö‡∏°‡∏≠‡∏á‡πÄ‡∏°‡∏¢‡πå‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏¢‡∏ô‡∏∞"</p>
                </div>
                <div class="timeline-item">
                    <h3>üê± ‡πÄ‡∏î‡∏ó‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà‡πÅ‡∏°‡∏ß</h3>
                    <img src="https://github.com/Rvenhub/i-love-u/blob/main/7.jpg?raw=true" class="timeline-img">
                    <p style="margin-top:15px">"‡πÄ‡∏°‡∏¢‡πå‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡∏ß‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏°‡∏≤‡∏Å (‡πÅ‡∏ï‡πà‡∏Å‡∏¥‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡∏à‡∏ô‡πÅ‡∏Å‡πâ‡∏°‡∏õ‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏¢ 555)"</p>
                </div>
                <div class="timeline-item">
                    <h3>üçû ‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡πâ‡∏ô</h3>
                    <p>"‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏õ‡∏¥‡πâ‡∏á‡∏≠‡∏£‡πà‡∏≠‡∏¢ ‡πÅ‡∏ï‡πà‡∏ó‡∏µ‡πà‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ‡∏Å‡∏¥‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏ò‡∏≠"</p>
                </div>
            </div>
            <button class="btn reveal-element" onclick="navigateTo('page-gallery')">‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏õ‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏Å‡∏±‡∏ô üëâ</button>
        </section>

        <section id="page-gallery" class="page">
            <h2 class="reveal-element">üì∑ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h2>
            <div class="card reveal-element" style="padding:0; overflow:hidden; height:400px; border:none;">
                <iframe src="https://padlet.com/embed/qt81x7v8qsaw7fi5" style="width:100%;height:100%;border:none;"></iframe>
            </div>
            <div class="card reveal-element">
                <h3>üìÇ ‡∏≠‡∏±‡∏õ‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏¥‡πà‡∏° (‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)</h3>
                <p style="font-size: 0.8rem; color: #888; margin-top: -10px; margin-bottom: 15px;">
                    <i class="fas fa-lock"></i> ‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à‡πÑ‡∏î‡πâ‡∏ô‡∏∞ ‡∏£‡∏π‡∏õ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÑ‡∏°‡πà‡∏´‡∏•‡∏∏‡∏î‡πÑ‡∏õ‡πÑ‡∏´‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
                </p>
                <input type="file" id="img-upload" accept="image/*" onchange="handleImageUpload(this)" style="margin: 10px 0;">
                <div class="gallery-grid" id="gallery-container"></div>
            </div>
            <button id="gallery-next-btn" class="btn btn-locked reveal-element" onclick="alert('‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏™‡∏±‡∏Å 1 ‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡πâ‡∏≤‡∏≤ ü•∫')">‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞ üîí</button>
        </section>

        <section id="page-game-menu" class="page">
            <h2 class="reveal-element">üéÆ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡πÉ‡∏à</h2>
            <p class="reveal-element" style="text-align:center; margin-bottom:20px;">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á 2 ‡πÄ‡∏Å‡∏° ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ!</p>
            <div class="game-menu-item reveal-element" id="menu-memory" onclick="navigateTo('page-game-memory')">
                <div style="display:flex; align-items:center;">
                    <div class="game-icon">üß†</div>
                    <div><h3 style="margin:0; text-align:left;">‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏π‡∏õ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h3><span style="font-size:0.9rem; color:#888;">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥</span></div>
                </div>
                <div class="game-status"><i class="far fa-circle"></i></div>
            </div>
            <div class="game-menu-item reveal-element" id="menu-rhythm" onclick="navigateTo('page-game-rhythm')">
                <div style="display:flex; align-items:center;">
                    <div class="game-icon">üéµ</div>
                    <div><h3 style="margin:0; text-align:left;">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏´‡∏±‡∏ß‡πÉ‡∏à</h3><span style="font-size:0.9rem; color:#888;">‡∏Å‡∏î‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡πÄ‡∏û‡∏•‡∏á</span></div>
                </div>
                <div class="game-status"><i class="far fa-circle"></i></div>
            </div>
            <button id="hub-next-btn" class="btn btn-locked reveal-element" onclick="checkAllGames()">‡∏¢‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡πÄ‡∏•‡∏¢ üîí</button>
        </section>

        <section id="page-game-memory" class="page">
            <h2 class="reveal-element">üß† ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏π‡∏õ</h2>
            <div class="card reveal-element" style="position: relative; min-height: 450px;">
                <div id="memory-start-overlay" class="result-overlay show" style="background:rgba(255,255,255,0.95);">
                    <h3>‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÑ‡∏´‡∏°?</h3>
                    <p>‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏π‡πà‡πÄ‡∏•‡∏¢‡∏ô‡∏∞</p>
                    <button class="btn" onclick="startMemoryGameReal()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°!</button>
                </div>
                <div class="memory-grid" id="memory-board"></div>
                <div id="memory-result" class="result-overlay">
                    <h1 style="font-size:4rem; margin:0;">üéâ</h1>
                    <h3>‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å!</h3>
                    <button class="btn" onclick="finishGame('memory')">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏Å‡∏° ‚úÖ</button>
                </div>
            </div>
            <button class="btn btn-outline reveal-element" onclick="navigateTo('page-game-menu')">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        </section>

        <section id="page-game-rhythm" class="page">
            <h2 class="reveal-element">üéµ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏´‡∏±‡∏ß‡πÉ‡∏à</h2>
            <p class="reveal-element" style="text-align:center;">‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ: <span id="heart-count" style="font-weight:bold; color:var(--primary-dark); font-size:1.2rem;">0</span>/20</p>
            <div class="card reveal-element" style="position:relative; padding:15px;">
                <div id="rhythm-canvas">
                    <div class="beat-line" style="position:absolute; bottom:60px; width:100%; height:5px; background:#ff8fa3; box-shadow:0 0 15px #ff8fa3;"></div>
                    <div id="hit-msg" class="hit-feedback"></div>
                </div>
                <div style="text-align:center; margin-top:20px;">
                    <button id="rhythm-btn" class="btn" style="width:100px; height:100px; border-radius:50%; font-size:3rem; display:inline-flex; align-items:center; justify-content:center; box-shadow: 0 10px 30px rgba(255, 71, 126, 0.5);">ü©∑</button>
                </div>
                <div id="rhythm-result" class="result-overlay">
                    <h1 style="font-size:4rem; margin:0;">üéµ</h1>
                    <h3>‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î!</h3>
                    <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="final-score" style="font-weight:bold; font-size:1.5rem;">0</span></p>
                    <button class="btn" onclick="finishGame('rhythm')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏• & ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π ‚úÖ</button>
                </div>
            </div>
            <button id="rhythm-start-btn" class="btn reveal-element" onclick="startGameRhythm()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
            <button class="btn btn-outline reveal-element" onclick="navigateTo('page-game-menu')">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        </section>

        <section id="page-quiz" class="page">
            <h2 class="reveal-element">‚ùì ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ß‡∏±‡∏î‡πÉ‡∏à</h2>
            <div class="quiz-progress reveal-element" id="quiz-progress"></div>
            <div class="card reveal-element">
                <div id="quiz-container"></div>
                <p id="quiz-feedback" style="text-align:center; font-weight:bold; height:20px; color:var(--primary-dark); margin-top:10px;"></p>
            </div>
            <button id="quiz-next-btn" class="btn hidden reveal-element" onclick="nextQuestion()">‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ üëâ</button>
            <button id="quiz-finish-btn" class="btn hidden reveal-element" onclick="navigateTo('page-message')">‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡πâ‡∏≤ üíå</button>
        </section>

        <section id="page-message" class="page">
            <div style="min-height:80vh; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                <h2 class="reveal-element" style="margin-bottom:40px;">‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á... ‡πÄ‡∏°‡∏¢‡πå‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á üíñ</h2>
                
                <div id="gift-box" class="gift-box-trigger reveal-element" onclick="openGift()">üéÅ</div>
                <p class="click-hint reveal-element" style="color:var(--primary-dark); margin-top:20px;">‡πÅ‡∏ï‡∏∞‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡πÄ‡∏•‡∏¢! (‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡πÄ‡∏•‡∏¢ üéÅ)</p>

                <div style="margin-top:50px; width:100%; max-width:300px; text-align:center;">
                    <button class="btn btn-outline reveal-element" onclick="navigateTo('page-settings')" style="margin-top:10px;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‚öôÔ∏è</button>
                    <p style="font-size:0.8rem; color:#888; margin-top:15px;">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2026</p>
                </div>
            </div>
        </section>

        <section id="page-settings" class="page">
            <h2>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h2>
            <div class="card">
                <p>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏û‡∏•‡∏á:</p> <input type="file" accept=".mp3" onchange="changeMusic(this)">
                <p style="font-size: 0.8rem; color: #aaa; margin-top: 5px;">
                    * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÄ‡∏°‡∏¢‡πå‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö
                </p>
                <br><br>
                <button class="btn btn-outline" onclick="clearData()" style="color:red; border-color:red;">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>
            <button class="btn" onclick="navigateTo('page-intro')">‡∏Å‡∏•‡∏±‡∏ö</button>
        </section>

    </div>

    <div class="music-player">
        <div id="album-art" class="player-disc"><div class="disc-inner"></div></div>
        <div class="player-info">
            <div id="track-name" class="track-name">‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏°</div>
            <div class="track-artist">scrubb</div>
        </div>
        <div class="visualizer stopped" id="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
        <button class="play-btn" onclick="togglePlay()"><i id="play-icon" class="fas fa-play"></i></button>
    </div>

    <div id="lightbox" class="lightbox" onclick="if(event.target===this) this.style.display='none'"><img id="lightbox-img" src=""></div>

    <script>
        // --- DATA & STATE ---
        const audio = document.getElementById('bg-music');
        let isPlaying = false;
        
        // Emotional State Variables
        let visitCount = parseInt(localStorage.getItem('may_visit_count')) || 0;
        let themeCycleCount = new Set(); 
        let pauseCount = 0; 
        let boxClickCount = 0;

        // Load State
        let currentTheme = localStorage.getItem('may_theme') || 'pastel';
        let gameStatus = JSON.parse(localStorage.getItem('may_games')) || { memory: false, rhythm: false };
        let galleryUnlocked = localStorage.getItem('may_gallery_unlocked') === 'true';
        let localImages = JSON.parse(localStorage.getItem('may_gallery')) || [];
        
        const instructions = {
            'page-timeline': { icon: '‚è≥', title: '‡∏¢‡πâ‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤', text: '‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏î‡∏π‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏ô‡∏∞' },
            'page-gallery': { icon: 'üì∏', title: '‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà', text: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà‡∏Å‡πà‡∏≠‡∏ô 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏ô‡∏∞!' },
            'page-game-menu': { icon: 'üéÆ', title: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Ñ‡∏π‡πà‡∏£‡∏±‡∏Å', text: '‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á 2 ‡πÄ‡∏Å‡∏° ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ!' },
            'page-game-memory': { icon: 'üß†', title: '‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏π‡∏õ', text: '‡∏´‡∏≤‡∏Ñ‡∏π‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡πÉ‡∏ö!' },
            'page-game-rhythm': { icon: 'üéµ', title: '‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏´‡∏±‡∏ß‡πÉ‡∏à', text: '‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ü©∑ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏´‡∏•‡πà‡∏ô‡∏•‡∏á‡∏°‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏™‡πâ‡∏ô (‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 20 ‡∏î‡∏ß‡∏á)' },
            'page-quiz': { icon: '‚ùì', title: '‡∏ß‡∏±‡∏î‡πÉ‡∏à', text: '‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡∏ô‡∏∞ ‡∏´‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≤‡∏°!' },
            'page-message': { icon: 'üíå', title: '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡πÉ‡∏à', text: '‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢...' }
        };

        // --- INIT & LOADING ---
        window.onload = () => {
            visitCount++;
            localStorage.setItem('may_visit_count', visitCount);

            // Theme & Ambient
            document.body.className = currentTheme + '-mode';
            document.querySelectorAll('.bird-final, .shooting-star-v3, .mixed-floater').forEach(e => e.remove());
            
            const h = new Date().getHours();
            if(currentTheme === 'morning') spawnBirdsFinal(h >= 6 && h <= 9 ? 1500 : 3000);
            else if(currentTheme === 'night') spawnShootingStarsV3(h >= 22 || h <= 4 ? 1200 : 2500);
            else if(currentTheme === 'pastel') spawnPastelMixed();

            loadGallery();
            typeWriter("‡πÄ‡∏Ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏°‡∏≤‡∏ù‡∏≤‡∏Å üíñ", "intro-title", 80);
            animatePageText(); 
            initParticles();
            
            setEmotionalGreeting(); 
            
            if (galleryUnlocked) updateGalleryButton();
            
            // Listeners
            document.addEventListener('mousemove', (e) => {
                const sun = document.querySelector('.sun');
                if(sun) {
                    const x = (window.innerWidth - e.pageX*2) / 100;
                    const y = (window.innerHeight - e.pageY*2) / 100;
                    sun.style.transform = `translate(${x}px, ${y}px) scale(1)`;
                }
            });
            document.addEventListener('click', (e) => { createClickHeart(e.pageX, e.pageY); });

            // Toast for returning visitor
            setTimeout(() => {
                if(visitCount === 3) showToast("‡πÄ‡∏°‡∏¢‡πå‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏µ‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏Ñ‡πâ‡∏≤‡∏î‡∏µ‡πÉ‡∏à‡∏ô‡∏∞ ü•π");
                else if(visitCount > 10) showToast("‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á‡πÄ‡∏Ñ‡πâ‡∏≤‡πÄ‡∏´‡∏£‡∏≠ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ö‡πà‡∏≠‡∏¢‡∏à‡∏±‡∏á üòú");
            }, 2500);
        };

        // --- EMOTIONAL GREETING ---
        function setEmotionalGreeting() {
            const h = new Date().getHours();
            let g = "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á üíñ";
            
            if(h >= 5 && h < 11) g = "‡∏≠‡∏£‡∏∏‡∏ì‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡πå‡∏ô‡∏∞‡πÄ‡∏°‡∏¢‡πå ‚òÄÔ∏è ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏¥‡πâ‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ ‡∏ô‡∏∞";
            else if(h >= 11 && h < 13) g = "‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏´‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡∏≠‡∏£‡πà‡∏≠‡∏¢‡πÜ ‡∏Å‡∏¥‡∏ô‡∏ô‡∏∞ üç±";
            else if(h >= 13 && h < 17) g = "‡∏ö‡πà‡∏≤‡∏¢‡πÜ ‡∏á‡πà‡∏ß‡∏á‡πÑ‡∏´‡∏°? ‡∏™‡∏π‡πâ‡πÜ ‡∏ô‡∏∞‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á ‚úåÔ∏è";
            else if(h >= 17 && h < 20) g = "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‡πÑ‡∏´‡∏°? ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞ üåá";
            else if(h >= 20 || h < 2) g = "‡∏î‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞ ‡πÄ‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡πà‡∏ß‡∏á üåô";
            else g = "‡∏ô‡∏≠‡∏ô‡∏î‡∏∂‡∏Å‡∏à‡∏±‡∏á... ‡∏ù‡∏±‡∏ô‡∏î‡∏µ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üí§";

            document.getElementById('greeting-text').innerText = g;
        }

        // --- THEME ---
        function setTheme(theme, autoNav = false) {
            currentTheme = theme; 
            localStorage.setItem('may_theme', theme); 
            document.body.className = theme + '-mode';
            
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active-theme'));
            
            if(autoNav) {
                themeCycleCount.add(theme);
                if(themeCycleCount.size === 3) {
                    setTimeout(() => showToast("‡πÄ‡∏°‡∏¢‡πå‡∏•‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÄ‡∏•‡∏¢ ü©∑ ‡∏ä‡∏≠‡∏ö‡∏≠‡∏±‡∏ô‡πÑ‡∏´‡∏ô‡∏™‡∏∏‡∏î?"), 1000);
                    themeCycleCount.clear(); 
                }
                
                let msg = "";
                if(theme === 'morning') msg = "‡πÄ‡∏ä‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏™‡∏î‡πÉ‡∏™‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏¢‡πå‡πÄ‡∏•‡∏¢ üåû";
                else if(theme === 'night') msg = "‡∏Ñ‡∏∑‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏™‡∏≠‡∏á‡∏Ñ‡∏ô‡∏ô‡∏∞ üåô";
                else msg = "‡πÇ‡∏´‡∏°‡∏î‡∏´‡∏ß‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÄ‡∏Ç‡∏¥‡∏ô üíï";
                showToast(msg);
                startApp();
            }

            document.querySelectorAll('.bird-final, .shooting-star-v3, .mixed-floater').forEach(e => e.remove());
            if(theme === 'morning') spawnBirdsFinal();
            else if(theme === 'night') spawnShootingStarsV3();
            else if(theme === 'pastel') spawnPastelMixed();
        }

        // Scene Logic
        function spawnBirdsFinal(interval=3000) { setInterval(() => { if(currentTheme !== 'morning') return; const b = document.createElement('div'); b.className = 'bird-final'; b.innerHTML = Math.random()>0.5 ? 'üïäÔ∏è' : 'üê¶'; b.style.setProperty('--startY', Math.random()*50+5+'%'); b.style.animation = `fly${Math.random()>0.5?'Right':'Left'}Wavy ${Math.random()*5+15}s linear forwards`; document.querySelector('.bg-morning').appendChild(b); setTimeout(()=>b.remove(), 20000); }, interval); }
        function spawnShootingStarsV3(interval=1800) { setInterval(() => { if(currentTheme !== 'night') return; const s = document.createElement('div'); s.className = 'shooting-star-v3'; s.style.setProperty('--startX', (Math.random()*40-50)+'%'); s.style.setProperty('--startY', (Math.random()*40-50)+'%'); const d = Math.random()*1+2+'s'; s.style.animation = `shootAcrossV3 ${d} ease-in-out forwards`; s.style.transform = `scale(${Math.random()*0.5+0.5})`; s.style.opacity = Math.random()*0.5+0.5; document.querySelector('.bg-night').appendChild(s); setTimeout(()=>s.remove(), parseFloat(d)*1000+200); }, interval); }
        function spawnPastelMixed() { const items = ['üíñ', '‚ú®', '‚ö™', 'üå∏']; setInterval(() => { if(currentTheme !== 'pastel') return; const b = document.createElement('div'); b.className = 'mixed-floater'; const item = items[Math.floor(Math.random()*items.length)]; if(item==='‚ö™'){b.style.width=(Math.random()*20+10)+'px';b.style.height=b.style.width;b.style.background='rgba(255,255,255,0.5)';b.style.borderRadius='50%';}else{b.innerHTML=item;b.style.fontSize=(Math.random()*20+15)+'px';} b.style.left=Math.random()*100+'%'; b.style.animationDuration=Math.random()*10+15+'s'; document.querySelector('.bg-pastel').appendChild(b); setTimeout(()=>b.remove(), 25000); }, 1200); }

        // --- ANIMATIONS ---
        function animatePageText() { const els = document.querySelectorAll('.page.active .reveal-element'); els.forEach((el, i) => { el.classList.remove('visible'); setTimeout(() => el.classList.add('visible'), i*200+300); }); }
        function typeWriter(txt, id, spd) { let i = 0; document.getElementById(id).innerHTML = `<span class="typing-cursor"></span>`; function type() { if(i<txt.length) { document.getElementById(id).innerHTML = txt.substring(0, i+1) + `<span class="typing-cursor"></span>`; i++; setTimeout(type, spd); } } type(); }

        // --- NAVIGATION ---
        function startApp() { initAudio(); navigateTo('page-timeline'); }
        function navigateTo(id) {
            const trans = document.getElementById('page-transition');
            trans.classList.add('active');
            
            setTimeout(() => {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); 
                document.getElementById(id).classList.add('active'); 
                window.scrollTo(0,0);
                trans.classList.remove('active');
                
                if(instructions[id]) showInstruction(instructions[id]); 
                animatePageText();
                
                if(id === 'page-message') closeGift();
                if(id === 'page-game-menu') updateGameMenuUI(); 
                if(id === 'page-game-memory') document.getElementById('memory-start-overlay').style.display = 'flex'; 
                if(id === 'page-game-rhythm') initRhythmGame();
            }, 500);
        }
        function showInstruction(d) { document.getElementById('inst-icon').innerText=d.icon; document.getElementById('inst-title').innerText=d.title; document.getElementById('inst-text').innerText=d.text; document.getElementById('instruction-modal').style.display='flex'; }
        function closeInstruction() { document.getElementById('instruction-modal').style.display='none'; }

        // --- AUDIO ---
        function initAudio() { audio.volume=0.5; audio.play().then(()=>{isPlaying=true;updatePlayerUI(); localStorage.setItem('may_music_played', 'true');}).catch(()=>{}); }
        function togglePlay() { 
            if(audio.paused){
                audio.play(); 
                isPlaying=true;
            } else {
                audio.pause(); 
                isPlaying=false;
                pauseCount++;
                if(pauseCount === 3) showToast("‡πÄ‡∏û‡∏•‡∏á‡∏ô‡∏µ‡πâ... ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á‡πÉ‡∏Ñ‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤? ü§≠");
            } 
            updatePlayerUI(); 
        }
        function updatePlayerUI() { const i=document.getElementById('play-icon'), d=document.getElementById('album-art'), v=document.getElementById('visualizer'), n=document.createElement('div'); if(isPlaying){i.className='fas fa-pause';d.classList.add('playing');v.classList.remove('stopped'); n.className='music-note'; n.innerHTML='üéµ'; n.style.left=(Math.random()*50+20)+'%'; n.style.bottom='50px'; document.querySelector('.music-player').appendChild(n); setTimeout(()=>n.remove(),1500);}else{i.className='fas fa-play';d.classList.remove('playing');v.classList.add('stopped');} }
        function changeMusic(inp) { if(inp.files[0]){audio.src=URL.createObjectURL(inp.files[0]); document.getElementById('track-name').innerText=inp.files[0].name; audio.play(); isPlaying=true; updatePlayerUI();} }

        // --- GALLERY ---
        const cloudImages = [{src:"https://github.com/Rvenhub/i-love-u/blob/main/6.jpg?raw=true"},{src:"https://github.com/Rvenhub/i-love-u/blob/main/5.jpg?raw=true"},{src:"https://github.com/Rvenhub/i-love-u/blob/main/4.jpg?raw=true"},{src:"https://github.com/Rvenhub/i-love-u/blob/main/3.jpg?raw=true"}]; 
        function loadGallery() { renderGallery(); }
        function renderGallery() { const c=document.getElementById('gallery-container'); c.innerHTML=''; localImages.forEach((img,i)=>c.innerHTML+=`<div class="gallery-item"><img src="${img.src}" onclick="openLightbox('${img.src}')"><button class="delete-btn" onclick="deleteImg(${i})">x</button></div>`); cloudImages.forEach(img=>c.innerHTML+=`<div class="gallery-item"><img src="${img.src}" onclick="openLightbox('${img.src}')"></div>`); }
        function handleImageUpload(inp) { 
            if(inp.files[0]){
                const r=new FileReader(); 
                r.onload=function(e){
                    localImages.unshift({src:e.target.result}); 
                    localStorage.setItem('may_gallery',JSON.stringify(localImages)); 
                    renderGallery();
                    showToast("‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏£‡∏π‡∏õ‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏ô‡∏∞ ‚ù§Ô∏è");
                }; 
                r.readAsDataURL(inp.files[0]);
            }
        }
        function deleteImg(i) { if(confirm("‡∏•‡∏ö?")){localImages.splice(i,1); localStorage.setItem('may_gallery',JSON.stringify(localImages)); renderGallery();}}
        function clearData() { if(confirm("‡∏•‡∏ö‡∏´‡∏°‡∏î?")){localStorage.clear(); location.reload();}}
        function openLightbox(src) { document.getElementById('lightbox-img').src=src; document.getElementById('lightbox').style.display='flex'; if(!galleryUnlocked){unlockGallery();}}
        function unlockGallery() { galleryUnlocked=true; localStorage.setItem('may_gallery_unlocked', 'true'); updateGalleryButton(); showToast("‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡πâ‡∏¢ üéÆ"); }
        function updateGalleryButton() { const b=document.getElementById('gallery-next-btn'); b.classList.remove('btn-locked'); b.innerText="‡πÑ‡∏õ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏Å‡∏±‡∏ô! üéÆ"; b.onclick=()=>navigateTo('page-game-menu'); }

        // --- GAMES ---
        function updateGameMenuUI() { if(gameStatus.memory)document.getElementById('menu-memory').classList.add('completed'); if(gameStatus.rhythm)document.getElementById('menu-rhythm').classList.add('completed'); if(gameStatus.memory&&gameStatus.rhythm){const b=document.getElementById('hub-next-btn'); b.classList.remove('btn-locked'); b.innerText="‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏õ‡∏ß‡∏±‡∏î‡πÉ‡∏à‡∏Å‡∏±‡∏ô üëâ"; b.onclick=()=>navigateTo('page-quiz');}}
        function finishGame(game) { gameStatus[game]=true; localStorage.setItem('may_games', JSON.stringify(gameStatus)); showToast("‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß üéâ"); navigateTo('page-game-menu'); }
        function checkAllGames() { if(!gameStatus.memory||!gameStatus.rhythm)alert("‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á 2 ‡πÄ‡∏Å‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡πâ‡∏≤‡∏≤ ü•∫"); }

        // Game 1: Memory (With Emotional Feedback)
        let flipped=[], matches=0; 
        function startMemoryGameReal(){document.getElementById('memory-start-overlay').style.display='none'; initMemoryGame();}
        function initMemoryGame() { const b=document.getElementById('memory-board'); b.innerHTML=''; flipped=[]; matches=0; document.getElementById('memory-result').style.display='none'; let imgs=[...cloudImages]; while(imgs.length<6)imgs=imgs.concat(cloudImages); imgs=imgs.slice(0,6); let deck=[...imgs,...imgs].sort(()=>0.5-Math.random()); deck.forEach(img=>{const c=document.createElement('div'); c.className='memory-card'; c.innerHTML=`<div class="memory-inner"><div class="mem-face mem-front">üß∏</div><div class="mem-face mem-back"><img src="${img.src}"></div></div>`; c.onclick=()=>{if(flipped.length<2&&!c.classList.contains('flipped')){c.classList.add('flipped'); flipped.push({el:c,src:img.src}); if(flipped.length===2)checkMemMatch();}}; b.appendChild(c);}); }
        
        function checkMemMatch() { 
            const [c1,c2] = flipped; 
            if(c1.src === c2.src){
                matches++; 
                flipped=[]; 
                const compliments = ["‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å!", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏î‡∏µ‡∏à‡∏±‡∏á", "‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÄ‡∏•‡∏¢!", "‡πÉ‡∏ä‡πà‡πÄ‡∏•‡∏¢!"];
                showToast(compliments[Math.floor(Math.random()*compliments.length)] + " üëç");
                
                if(matches === 6) setTimeout(() => document.getElementById('memory-result').style.display='flex', 500);
            } else {
                showToast("‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞ ‚úåÔ∏è");
                setTimeout(()=>{
                    c1.el.classList.remove('flipped'); 
                    c2.el.classList.remove('flipped'); 
                    flipped=[];
                }, 800);
            } 
        }

        // Game 2: Rhythm (With Emotional Feedback)
        let rScore=0, rCount=0, rInterval, isRPlaying=false; 
        function initRhythmGame(){isRPlaying=false; clearInterval(rInterval); document.getElementById('rhythm-start-btn').classList.remove('hidden'); document.getElementById('rhythm-result').style.display='none'; document.querySelectorAll('.falling-heart').forEach(e=>e.remove()); document.getElementById('heart-count').innerText="0/20"; document.getElementById('rhythm-btn').disabled=true;}
        function startGameRhythm(){initRhythmGame(); isRPlaying=true; rScore=0; rCount=0; document.getElementById('rhythm-start-btn').classList.add('hidden'); document.getElementById('rhythm-btn').disabled=false; let spawned=0; rInterval=setInterval(()=>{if(!isRPlaying)return; if(spawned<20){spawnHeart(); spawned++;}else{clearInterval(rInterval);}},1000); document.getElementById('rhythm-btn').onclick=checkRhythmHit;}
        
        function spawnHeart(){
            const h=document.createElement('div'); h.className='falling-heart'; h.innerHTML=currentTheme==='night'?'‚≠ê':'‚ù§Ô∏è'; h.style.left=Math.random()*80+10+'%'; h.style.top='-50px'; document.getElementById('rhythm-canvas').appendChild(h); 
            let pos=-50, fall=setInterval(()=>{
                if(!isRPlaying){clearInterval(fall);h.remove();return;} 
                pos+=4; h.style.top=pos+'px'; 
                if(pos>320){
                    clearInterval(fall);h.remove();
                    showFeedback("MISS","#ccc"); 
                    if(Math.random() > 0.7) showToast("‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏µ‡∏ö‡∏ô‡∏∞ ‡πÄ‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‚úåÔ∏è");
                    checkRhythmEnd();
                }
            },20); h.dataset.timer=fall;
        }

        function checkRhythmHit(){
            if(!isRPlaying)return; let hit=false; 
            document.querySelectorAll('.falling-heart').forEach(h=>{
                if(hit)return; let top=parseInt(h.style.top); 
                if(top>200&&top<300){
                    hit=true; clearInterval(h.dataset.timer); h.remove(); 
                    rCount++; rScore+=100; document.getElementById('heart-count').innerText=rCount+"/20"; 
                    showFeedback("PERFECT!","#ff4d6d"); 
                    if(rCount === 10) showToast("‡πÄ‡∏°‡∏¢‡πå‡∏à‡∏±‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏á‡∏à‡∏±‡∏á üíì");
                    checkRhythmEnd();
                }
            });
        }
        function showFeedback(t,c){const e=document.getElementById('hit-msg'); e.innerText=t; e.style.color=c; e.style.animation='none'; e.offsetHeight; e.style.animation='popMsg 0.5s ease-out forwards';}
        function checkRhythmEnd(){if(rCount>=10){document.getElementById('final-score').innerText=rScore; document.getElementById('rhythm-result').style.display='flex'; isRPlaying=false;}}

        // Quiz
        const qData=[{q:"‡πÄ‡∏°‡∏¢‡πå‡∏ä‡∏≠‡∏ö‡∏Å‡∏¥‡∏ô‡∏≠‡∏∞‡πÑ‡∏£?",a:["‡∏Ç‡πâ‡∏≤‡∏ß‡∏ï‡πâ‡∏°","‡∏Ç‡∏ô‡∏°","‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î","‡∏ú‡∏•‡πÑ‡∏°‡πâ"],c:1},{q:"‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö?",a:["‡∏ä‡∏°‡∏û‡∏π","‡∏°‡πà‡∏ß‡∏á","‡∏Ç‡∏≤‡∏ß","‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß"],c:0},{q:"‡πÄ‡∏î‡∏ó‡πÅ‡∏£‡∏Å?",a:["‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà‡πÅ‡∏°‡∏ß","‡πÇ‡∏£‡∏á‡∏´‡∏ô‡∏±‡∏á","‡∏™‡∏ß‡∏ô","‡∏´‡πâ‡∏≤‡∏á"],c:0},{q:"‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á?",a:["‡πÅ‡∏°‡∏ß","‡∏´‡∏°‡∏≤","‡∏ô‡∏Å","‡∏õ‡∏•‡∏≤"],c:0}]; let qIdx=0;
        function nextQuestion(){if(qIdx>=qData.length)return; const d=qData[qIdx]; document.getElementById('quiz-progress').innerHTML=qData.map((_,i)=>`<div class="progress-dot ${i===qIdx?'active':''} ${i<qIdx?'done':''}"></div>`).join(''); document.getElementById('quiz-container').innerHTML=`<h3 style="margin-bottom:20px;">${qIdx+1}. ${d.q}</h3>${d.a.map((ans,i)=>`<div class="quiz-option" onclick="checkQuiz(${i}, this)">${ans}</div>`).join('')}`; document.getElementById('quiz-feedback').innerText=""; document.getElementById('quiz-next-btn').classList.add('hidden');}
        function checkQuiz(i,el){
            if(i===qData[qIdx].c){
                document.querySelectorAll('.quiz-option').forEach(o=>o.style.pointerEvents='none'); el.classList.add('correct'); document.getElementById('quiz-feedback').innerText="‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! üíï"; qIdx++; confettiEffect(); 
                if(qIdx<qData.length)document.getElementById('quiz-next-btn').classList.remove('hidden'); 
                else document.getElementById('quiz-finish-btn').classList.remove('hidden');
            }else{
                el.classList.add('wrong'); document.getElementById('quiz-feedback').innerText="‡∏ú‡∏¥‡∏î‡∏ô‡∏∞‡∏à‡πä‡∏∞ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà! üòú"; 
                showToast("‡∏ú‡∏¥‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ô‡πâ‡∏≤ ü•∫");
                setTimeout(()=>{el.classList.remove('wrong'); document.getElementById('quiz-feedback').innerText="";},800);
            }
        } nextQuestion();

        // --- SUPER GIFT BOX ---
        function openGift() { 
            boxClickCount++;
            
            if(boxClickCount > 7) {
                showToast("‡πÉ‡∏à‡∏£‡πâ‡∏≠‡∏ô‡∏à‡∏±‡∏á... ‡∏á‡∏±‡πâ‡∏ô‡πÄ‡∏≠‡∏≤‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÑ‡∏õ‡πÄ‡∏•‡∏¢! üåπ");
                openGiftSecret();
                return;
            }

            document.getElementById('final-overlay').classList.add('show');
            document.getElementById('card-popup').classList.add('show');
            
            const textContainer = document.getElementById('popup-text'); 
            textContainer.innerHTML = ""; 
            
            const script = [
                { text: "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ô‡∏à‡∏ö‡∏ô‡∏∞...", delay: 50 },
                { text: "<br>...", delay: 800 },
                { text: "<br>‡∏≠‡∏¢‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤ '‡∏£‡∏±‡∏Å' ‡∏Ñ‡∏≥‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏û‡∏≠", delay: 50 },
                { text: "<br>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏¢‡πå‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡πâ‡∏≤", delay: 50 },
                { text: "<br>‡∏î‡∏µ‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏¢‡πå‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏ô‡∏∞ üíñ", delay: 100 },
                { text: "<br><br>‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡∏ô‡∏≤‡∏ô‡πÜ ‡∏ô‡∏∞‡∏Ñ‡∏∞‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á", delay: 100 }
            ];
            
            runTypewriterScript(textContainer, script);
            confettiEffect();
        }

        function openGiftSecret() {
            document.getElementById('final-overlay').classList.add('show');
            document.getElementById('card-popup').classList.add('show');
            const textContainer = document.getElementById('popup-text'); 
            textContainer.innerHTML = ""; 

            const script = [
                { text: "‡πÇ‡∏≠‡πÄ‡∏Ñ‡πÜ ‡∏¢‡∏≠‡∏°‡πÅ‡∏û‡πâ‡πÅ‡∏•‡πâ‡∏ß üò≥", delay: 50 },
                { text: "<br>‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏Å‡∏î‡∏£‡∏±‡∏ß‡πÜ ‡πÅ‡∏•‡πâ‡∏ß...", delay: 50 },
                { text: "<br>‡πÄ‡∏Ñ‡πâ‡∏≤‡∏£‡∏±‡∏Å‡πÄ‡∏°‡∏¢‡πå‡∏°‡∏≤‡∏Å‡πÜ‡πÜ‡πÜ‡πÜ ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡πÄ‡∏•‡∏¢!", delay: 30 },
                { text: "<br>‡∏´‡πâ‡∏≤‡∏°‡∏ó‡∏¥‡πâ‡∏á‡πÄ‡∏Ñ‡πâ‡∏≤‡πÑ‡∏õ‡πÑ‡∏´‡∏ô‡∏ô‡∏∞ ‚ù§Ô∏è", delay: 100 }
            ];
            runTypewriterScript(textContainer, script);
            confettiEffect();
        }

        async function runTypewriterScript(container, lines) {
            for (let line of lines) {
                await new Promise(resolve => {
                    let i = 0;
                    if(line.text.startsWith('<')) {
                        container.innerHTML += line.text;
                        setTimeout(resolve, line.delay);
                    } else {
                        const timer = setInterval(() => {
                            container.innerHTML += line.text.charAt(i);
                            i++;
                            if (i >= line.text.length) {
                                clearInterval(timer);
                                setTimeout(resolve, 300);
                            }
                        }, line.delay);
                    }
                });
            }
        }

        function closeGift() { document.getElementById('final-overlay').classList.remove('show'); document.getElementById('card-popup').classList.remove('show'); }
        function saveToHeart() { showToast("‡πÄ‡∏ã‡∏ü‡πÑ‡∏ß‡πâ‡∏î‡∏π‡∏ï‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚ù§Ô∏è"); localStorage.setItem('may_gift_opened', 'true'); }

        // --- TOAST & CLICK PARTICLES ---
        function showToast(text) { const t = document.getElementById('toast'); t.innerText = text; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 3000); }
        function createClickHeart(x, y) { const h = document.createElement('div'); h.className = 'click-heart'; h.innerHTML = 'üíñ'; h.style.left = x + 'px'; h.style.top = y + 'px'; document.body.appendChild(h); setTimeout(() => h.remove(), 1000); }

        // --- PARTICLES ---
        function initParticles() { const c=document.getElementById('particle-canvas'), x=c.getContext('2d'); c.width=window.innerWidth; c.height=window.innerHeight; const p=Array(40).fill().map(()=>({x:Math.random()*c.width, y:Math.random()*c.height, s:Math.random()*2+1, o:Math.random()})); function loop(){x.clearRect(0,0,c.width,c.height); x.fillStyle=currentTheme==='night'?'#ffffff':'#ff7eb3'; p.forEach(o=>{if(currentTheme==='night')o.o+=(Math.random()-0.5)*0.1; if(o.o<0)o.o=0; if(o.o>1)o.o=1; x.globalAlpha=o.o; x.beginPath(); x.arc(o.x, o.y, o.s, 0, Math.PI*2); x.fill();}); requestAnimationFrame(loop);} loop(); }
        function confettiEffect() { for(let i=0; i<30; i++){const c=document.createElement('div'); c.style.position='fixed'; c.style.left=Math.random()*100+'vw'; c.style.top='-10px'; c.style.width='8px'; c.style.height='8px'; c.style.backgroundColor=['#ff0','#0f0','#00f','#ff6b81'][Math.floor(Math.random()*4)]; c.style.zIndex='9999'; c.style.transition='top 1s ease-in'; document.body.appendChild(c); setTimeout(()=>{c.style.top='100vh';},10); setTimeout(()=>{c.remove()},1000);} }
        window.addEventListener('resize', initParticles);
        
        // Accessibility
        document.addEventListener('keydown', function(e) { if(e.key === "Escape") { closeGift(); document.getElementById('lightbox').style.display = 'none'; document.getElementById('instruction-modal').style.display = 'none'; } });
    </script>
</body>
</html>
